<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rigs of Rods project documentation"><meta name=author content="Rigs of Rods contributors"><link href=https://rigsofrods.org/terrain-creation/race-generator/ rel=canonical><link href=../building-rail-tracks/ rel=prev><link href=../scripting/ rel=next><link rel=icon href=../../ror-favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Race script generator - Rigs of Rods Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Maven+Pro:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Maven Pro";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/ror.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=custom> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#race-script-generator class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Rigs of Rods Documentation" class="md-header__button md-logo" aria-label="Rigs of Rods Documentation" data-md-component=logo> <img src=../../images/branding/RoR_Logo_TT.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rigs of Rods Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Race script generator </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=custom aria-label=Dark type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=Dark for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=custom aria-label=Light type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=Light for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/RigsOfRods/docs.rigsofrods.org title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> RigsOfRods/docs.rigsofrods.org </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Rigs of Rods Documentation" class="md-nav__button md-logo" aria-label="Rigs of Rods Documentation" data-md-component=logo> <img src=../../images/branding/RoR_Logo_TT.png alt=logo> </a> Rigs of Rods Documentation </label> <div class=md-nav__source> <a href=https://github.com/RigsOfRods/docs.rigsofrods.org title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> RigsOfRods/docs.rigsofrods.org </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Gameplay </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Gameplay </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gameplay/installing-the-game/ class=md-nav__link> <span class=md-ellipsis> Installation Guide </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/general-faq/ class=md-nav__link> <span class=md-ellipsis> General FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/common-issues/ class=md-nav__link> <span class=md-ellipsis> Common issues </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/beginners-guide/ class=md-nav__link> <span class=md-ellipsis> Beginner's Guide </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/installing-content/ class=md-nav__link> <span class=md-ellipsis> Installing content (mods) </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/controls-config/ class=md-nav__link> <span class=md-ellipsis> Controls and configuration </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/vehicle-ai/ class=md-nav__link> <span class=md-ellipsis> Vehicle AI </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/tuning/ class=md-nav__link> <span class=md-ellipsis> Tuning menu </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/aircraft-handling/ class=md-nav__link> <span class=md-ellipsis> Aircraft handling </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/multiplayer-server-setup/ class=md-nav__link> <span class=md-ellipsis> Multiplayer server setup </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/version-2020-01-faq/ class=md-nav__link> <span class=md-ellipsis> Version 2020.01 FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../gameplay/jargon/ class=md-nav__link> <span class=md-ellipsis> Jargon </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Tools and tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tools and tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools-tutorials/addons/ class=md-nav__link> <span class=md-ellipsis> Installing addons (Manual) </span> </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/modding-suspension/ class=md-nav__link> <span class=md-ellipsis> Modifying suspension (lifting, lowering, width, camber) </span> </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/blender-mesh-editing/ class=md-nav__link> <span class=md-ellipsis> Blender (2.7) mesh editing </span> </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/editor-nodeSnap/ class=md-nav__link> <span class=md-ellipsis> Editor nodeSnap </span> </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/visual-editors/ class=md-nav__link> <span class=md-ellipsis> Visual editors </span> </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/contributing-github/ class=md-nav__link> <span class=md-ellipsis> How to contribute to community projects using GitHub </span> </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/docs-contributing-guide/ class=md-nav__link> <span class=md-ellipsis> Docs Contributing Guide </span> </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/branding/ class=md-nav__link> <span class=md-ellipsis> Branding </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Vehicle creation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Vehicle creation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../vehicle-creation/fileformat-truck/ class=md-nav__link> <span class=md-ellipsis> Truck file format </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/fileformat-soundscript/ class=md-nav__link> <span class=md-ellipsis> Soundscript file format </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/fileformat-addonpart/ class=md-nav__link> <span class=md-ellipsis> Addonpart file format </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/alternate-skins/ class=md-nav__link> <span class=md-ellipsis> Alternate skins (skinzips) </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/engine/ class=md-nav__link> <span class=md-ellipsis> Engine </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/flares/ class=md-nav__link> <span class=md-ellipsis> Flares </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/flexbody-wheels/ class=md-nav__link> <span class=md-ellipsis> Flexbody wheels </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/flexbody-deforming-detaching-parts/ class=md-nav__link> <span class=md-ellipsis> Flexbody deforming/detaching parts </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/aircraft-and-aerodynamics/ class=md-nav__link> <span class=md-ellipsis> Aircraft and aerodynamics </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/rail-vehicles/ class=md-nav__link> <span class=md-ellipsis> Rail vehicles </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/boats/ class=md-nav__link> <span class=md-ellipsis> Boats </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/motorbikes/ class=md-nav__link> <span class=md-ellipsis> Motorbikes </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/tracked-vehicles/ class=md-nav__link> <span class=md-ellipsis> Tracked vehicles </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/vehicle-concepts/ class=md-nav__link> <span class=md-ellipsis> Vehicle (Node/Beam) concepts </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/suspension/ class=md-nav__link> <span class=md-ellipsis> Suspension </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/wheels-axles-steering/ class=md-nav__link> <span class=md-ellipsis> Wheels, axles, steering </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/special-components/ class=md-nav__link> <span class=md-ellipsis> Special components </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/weight-tuning/ class=md-nav__link> <span class=md-ellipsis> Weight tuning </span> </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/making-custom-hud/ class=md-nav__link> <span class=md-ellipsis> Making custom dashboard HUD </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Terrain creation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Terrain creation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../terrn2-subsystem/ class=md-nav__link> <span class=md-ellipsis> Terrn2 file format </span> </a> </li> <li class=md-nav__item> <a href=../terrain-conversion-terrn2/ class=md-nav__link> <span class=md-ellipsis> Converting old terrain to terrn2 format </span> </a> </li> <li class=md-nav__item> <a href=../editing-terrain-objects/ class=md-nav__link> <span class=md-ellipsis> Editing terrain objects </span> </a> </li> <li class=md-nav__item> <a href=../object-format/ class=md-nav__link> <span class=md-ellipsis> Object (odef) file format </span> </a> </li> <li class=md-nav__item> <a href=../collision-meshes/ class=md-nav__link> <span class=md-ellipsis> Collision meshes </span> </a> </li> <li class=md-nav__item> <a href=../l3dt-map-making/ class=md-nav__link> <span class=md-ellipsis> L3DT Map Making </span> </a> </li> <li class=md-nav__item> <a href=../shadows/ class=md-nav__link> <span class=md-ellipsis> Shadows </span> </a> </li> <li class=md-nav__item> <a href=../building-rail-tracks/ class=md-nav__link> <span class=md-ellipsis> Building rail tracks </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Race script generator </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Race script generator </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-is-this class=md-nav__link> <span class=md-ellipsis> What is this? </span> </a> </li> <li class=md-nav__item> <a href=#instructions class=md-nav__link> <span class=md-ellipsis> Instructions </span> </a> <nav class=md-nav aria-label=Instructions> <ul class=md-nav__list> <li class=md-nav__item> <a href=#general-race-info class=md-nav__link> <span class=md-ellipsis> General race info </span> </a> <nav class=md-nav aria-label="General race info"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#race-name class=md-nav__link> <span class=md-ellipsis> Race name </span> </a> </li> <li class=md-nav__item> <a href=#amount-of-laps class=md-nav__link> <span class=md-ellipsis> Amount of laps </span> </a> </li> <li class=md-nav__item> <a href=#race-version class=md-nav__link> <span class=md-ellipsis> Race version </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#race-options class=md-nav__link> <span class=md-ellipsis> Race options </span> </a> <nav class=md-nav aria-label="Race options"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#finishing-obligatory class=md-nav__link> <span class=md-ellipsis> Finishing obligatory? </span> </a> </li> <li class=md-nav__item> <a href=#show-time-difference class=md-nav__link> <span class=md-ellipsis> Show time difference? </span> </a> </li> <li class=md-nav__item> <a href=#show-best-lap-time class=md-nav__link> <span class=md-ellipsis> Show best lap time? </span> </a> </li> <li class=md-nav__item> <a href=#show-best-race-time class=md-nav__link> <span class=md-ellipsis> Show best race time? </span> </a> </li> <li class=md-nav__item> <a href=#submit-best-time class=md-nav__link> <span class=md-ellipsis> Submit best time? </span> </a> </li> <li class=md-nav__item> <a href=#silent-mode class=md-nav__link> <span class=md-ellipsis> Silent mode? </span> </a> </li> <li class=md-nav__item> <a href=#allow-race-restart class=md-nav__link> <span class=md-ellipsis> Allow race restart? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#checkpoint-locations-and-objects class=md-nav__link> <span class=md-ellipsis> Checkpoint locations and objects </span> </a> <nav class=md-nav aria-label="Checkpoint locations and objects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#retrieving-checkpoint-coordinates class=md-nav__link> <span class=md-ellipsis> Retrieving checkpoint coordinates </span> </a> </li> <li class=md-nav__item> <a href=#adding-coordinates class=md-nav__link> <span class=md-ellipsis> Adding coordinates </span> </a> </li> <li class=md-nav__item> <a href=#checkpoint-objects class=md-nav__link> <span class=md-ellipsis> Checkpoint objects </span> </a> <nav class=md-nav aria-label="Checkpoint objects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#f1-test-track-checkpoint class=md-nav__link> <span class=md-ellipsis> F1 Test Track Checkpoint </span> </a> </li> <li class=md-nav__item> <a href=#empty-checkpoint class=md-nav__link> <span class=md-ellipsis> Empty Checkpoint </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#race-abort-points class=md-nav__link> <span class=md-ellipsis> Race abort points </span> </a> </li> <li class=md-nav__item> <a href=#race-penalty-events class=md-nav__link> <span class=md-ellipsis> Race penalty events </span> </a> </li> <li class=md-nav__item> <a href=#general-settings class=md-nav__link> <span class=md-ellipsis> General settings </span> </a> <nav class=md-nav aria-label="General settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#show-checkpoint-info class=md-nav__link> <span class=md-ellipsis> Show checkpoint info? </span> </a> </li> <li class=md-nav__item> <a href=#script-filename class=md-nav__link> <span class=md-ellipsis> Script filename </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#general-abort-points class=md-nav__link> <span class=md-ellipsis> General abort points </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#generating-completed-script class=md-nav__link> <span class=md-ellipsis> Generating completed script </span> </a> </li> <li class=md-nav__item> <a href=#adding-script-to-terrain class=md-nav__link> <span class=md-ellipsis> Adding script to terrain </span> </a> <nav class=md-nav aria-label="Adding script to terrain"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#in-game class=md-nav__link> <span class=md-ellipsis> In-game </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fine-tuning-checkpoint-locations class=md-nav__link> <span class=md-ellipsis> Fine tuning checkpoint locations </span> </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../scripting/ class=md-nav__link> <span class=md-ellipsis> Scripting </span> </a> </li> <li class=md-nav__item> <a href=../raw-heightmaps/ class=md-nav__link> <span class=md-ellipsis> RAW Heightmaps </span> </a> </li> <li class=md-nav__item> <a href=../custom-texture-splatting/ class=md-nav__link> <span class=md-ellipsis> Alpha splatting </span> </a> </li> <li class=md-nav__item> <a href=../old-terrn-subsystem/ class=md-nav__link> <span class=md-ellipsis> Old (0.3x) terrain file format </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Rules </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Rules </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../rules/community-guidelines/ class=md-nav__link> <span class=md-ellipsis> Community Guidelines </span> </a> </li> <li class=md-nav__item> <a href=../../rules/forum-rules/ class=md-nav__link> <span class=md-ellipsis> Forum Rules </span> </a> </li> <li class=md-nav__item> <a href=../../rules/repository-submission-guidelines/ class=md-nav__link> <span class=md-ellipsis> Repository Submission Guidelines </span> </a> </li> <li class=md-nav__item> <a href=../../rules/contributor-code-of-conduct/ class=md-nav__link> <span class=md-ellipsis> Contributor Code of Conduct </span> </a> </li> <li class=md-nav__item> <a href=../../rules/multiplayer-rules-to-play-by/ class=md-nav__link> <span class=md-ellipsis> Multiplayer Rules to Play By </span> </a> </li> <li class=md-nav__item> <a href=../../rules/privacy-policy/ class=md-nav__link> <span class=md-ellipsis> Privacy Policy </span> </a> </li> <li class=md-nav__item> <a href=../../rules/terms-of-service/ class=md-nav__link> <span class=md-ellipsis> Terms of Service </span> </a> </li> <li class=md-nav__item> <a href=../../rules/project-governance/ class=md-nav__link> <span class=md-ellipsis> Project Governance </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-is-this class=md-nav__link> <span class=md-ellipsis> What is this? </span> </a> </li> <li class=md-nav__item> <a href=#instructions class=md-nav__link> <span class=md-ellipsis> Instructions </span> </a> <nav class=md-nav aria-label=Instructions> <ul class=md-nav__list> <li class=md-nav__item> <a href=#general-race-info class=md-nav__link> <span class=md-ellipsis> General race info </span> </a> <nav class=md-nav aria-label="General race info"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#race-name class=md-nav__link> <span class=md-ellipsis> Race name </span> </a> </li> <li class=md-nav__item> <a href=#amount-of-laps class=md-nav__link> <span class=md-ellipsis> Amount of laps </span> </a> </li> <li class=md-nav__item> <a href=#race-version class=md-nav__link> <span class=md-ellipsis> Race version </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#race-options class=md-nav__link> <span class=md-ellipsis> Race options </span> </a> <nav class=md-nav aria-label="Race options"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#finishing-obligatory class=md-nav__link> <span class=md-ellipsis> Finishing obligatory? </span> </a> </li> <li class=md-nav__item> <a href=#show-time-difference class=md-nav__link> <span class=md-ellipsis> Show time difference? </span> </a> </li> <li class=md-nav__item> <a href=#show-best-lap-time class=md-nav__link> <span class=md-ellipsis> Show best lap time? </span> </a> </li> <li class=md-nav__item> <a href=#show-best-race-time class=md-nav__link> <span class=md-ellipsis> Show best race time? </span> </a> </li> <li class=md-nav__item> <a href=#submit-best-time class=md-nav__link> <span class=md-ellipsis> Submit best time? </span> </a> </li> <li class=md-nav__item> <a href=#silent-mode class=md-nav__link> <span class=md-ellipsis> Silent mode? </span> </a> </li> <li class=md-nav__item> <a href=#allow-race-restart class=md-nav__link> <span class=md-ellipsis> Allow race restart? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#checkpoint-locations-and-objects class=md-nav__link> <span class=md-ellipsis> Checkpoint locations and objects </span> </a> <nav class=md-nav aria-label="Checkpoint locations and objects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#retrieving-checkpoint-coordinates class=md-nav__link> <span class=md-ellipsis> Retrieving checkpoint coordinates </span> </a> </li> <li class=md-nav__item> <a href=#adding-coordinates class=md-nav__link> <span class=md-ellipsis> Adding coordinates </span> </a> </li> <li class=md-nav__item> <a href=#checkpoint-objects class=md-nav__link> <span class=md-ellipsis> Checkpoint objects </span> </a> <nav class=md-nav aria-label="Checkpoint objects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#f1-test-track-checkpoint class=md-nav__link> <span class=md-ellipsis> F1 Test Track Checkpoint </span> </a> </li> <li class=md-nav__item> <a href=#empty-checkpoint class=md-nav__link> <span class=md-ellipsis> Empty Checkpoint </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#race-abort-points class=md-nav__link> <span class=md-ellipsis> Race abort points </span> </a> </li> <li class=md-nav__item> <a href=#race-penalty-events class=md-nav__link> <span class=md-ellipsis> Race penalty events </span> </a> </li> <li class=md-nav__item> <a href=#general-settings class=md-nav__link> <span class=md-ellipsis> General settings </span> </a> <nav class=md-nav aria-label="General settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#show-checkpoint-info class=md-nav__link> <span class=md-ellipsis> Show checkpoint info? </span> </a> </li> <li class=md-nav__item> <a href=#script-filename class=md-nav__link> <span class=md-ellipsis> Script filename </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#general-abort-points class=md-nav__link> <span class=md-ellipsis> General abort points </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#generating-completed-script class=md-nav__link> <span class=md-ellipsis> Generating completed script </span> </a> </li> <li class=md-nav__item> <a href=#adding-script-to-terrain class=md-nav__link> <span class=md-ellipsis> Adding script to terrain </span> </a> <nav class=md-nav aria-label="Adding script to terrain"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#in-game class=md-nav__link> <span class=md-ellipsis> In-game </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fine-tuning-checkpoint-locations class=md-nav__link> <span class=md-ellipsis> Fine tuning checkpoint locations </span> </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/RigsOfRods/docs.rigsofrods.org/blob/master/source/terrain-creation/race-generator.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/RigsOfRods/docs.rigsofrods.org/raw/master/source/terrain-creation/race-generator.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=race-script-generator>Race script generator<a class=headerlink href=#race-script-generator title="Permanent link">&para;</a></h1> <!--
    TODO:
        - RaceCancel instead of callback (nvm, would get called too often) -> 1 callback/cancelpoint
        - Be able to read log files as checkpoints
        - Allow message/callback
        - Add ( show / hide ) to advanced options
        - Add introductory text to every fieldset
        - Add colour to fieldset width low opcacity (or only to big fieldsets)
--> <style type=text/css>
    body, fieldset {
        min-width: 400px;
    }

@media (prefers-color-scheme: light) {
    .info {
        color: #3F3F3F;
        /*font-size: x-small;*/
    }
    .bigButton {
        width: 200px;
        height: 30px;
        font-weight: bold;
        background: white;
    }

    .smallButton {
        background: white;
    }

    .smallNumberField {
        width: 50px;
        background: white;
    }

    .shortTextField {
        width: 150px;
        background: white;
    }

    .longTextField {
        width: 428px;
        background: white;
    }

    .inputBox {
        background-color: white;
    }
    fieldset {
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;

        background-color: #E5E5E5;
    }
}

@media (prefers-color-scheme: dark) {
    .info {
        color: #C1C1C1;
        /*font-size: x-small;*/
    }
    .bigButton {
        width: 200px;
        height: 30px;
        font-weight: bold;
        background: #191919;
    }

    .smallButton {
        background: #191919;
    }

    .smallNumberField {
        width: 50px;
        background: #191919;
    }

    .shortTextField {
        width: 150px;
        background: #191919;
    }

    .longTextField {
        width: 428px;
        background: #191919;
    }

    .inputBox {
        background-color: #191919;
    }
    fieldset {
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;

        background-color: #333;
    }
}

    label {
        display: inline-table;
    }



    .intro {
        font-style: italic;
    }

    .scriptResult {
        width: 100%;
        height: 300px;
    }

    .checkpointsInputField {

        width: 100%;
        height: 300px;

        #vertical-align: top;
    }

    .closeIcon {
        float: right;
        cursor: pointer;
        text-decoration: underline;
        color: red;
    }

    #errorMessageField {
        margin-left: 20px;
    }

    legend {
        font-weight: bold;
    }
</style> <script type=text/javascript>
    var free_race = 0;
    var races = new Array();
    var free_checkpoint = 0;
    var checkpointFieldFocussed = false;
    var myScriptFile = new scriptFile();
    var lastAbortMessage = '[noMessage]';
    var abortMessageHandlers = new Array();
    var free_abortMessageHandler = 0;

    function scriptFile() {
        this.errormsg = "";
        this.errors = 0;
        this.lapSelections = {
            'No laps (the first checkpoint will be the start line and the last checkpoint will be the finish line)': 'races.LAPS_NoLaps',
            '1 lap (the first checkpoint will be both the start and finish line)': 'races.LAPS_One',
            '2 laps': '2',
            '3 laps': '3',
            '4 laps': '4',
            '5 laps': '5',
            '6 laps': '6',
            '7 laps': '7',
            '8 laps': '8',
            '9 laps': '9',
            'Never ending race (unlimited amount of laps)': 'races.LAPS_Unlimited',
            'other...': '[other]'
        };
        this.scriptSections = {
            'main': '',
            'general': '',
            'RaceStart': '',
            'PenaltyEvent': ''
        }

        this.generateRace = function (id) {
            var r;
            r = this.getRaceData(id);
            if (r < 0) return;
            r = this.buildRace(id);
            if (r < 0) return;

            return 1;
        }

        this.getRaceData = function (id) {
            // NAME
            {
                // get name
                races[id].name = document.getElementById("race_" + id + "_raceName").value;
                // trim the name
                races[id].name = races[id].name.replace(/^\s+|\s+$/g, '');
                // check the name
                if (races[id].name == "") {
                    this.errormsg += fatalError("Critical error detected in race (" + id + "): No name set, cannot build race (race ignored).");
                    ++this.errors;
                    return -1;
                }
            }

            // LAPS
            {
                // get the amount of laps
                if (document.getElementById("race_" + id + "_laps").value in this.lapSelections)
                    races[id].laps = this.lapSelections[document.getElementById("race_" + id + "_laps").value];
                else {
                    this.errormsg += fatalError("Critical error detected in race " + races[id].name + " (" + id + "): Unhandled amount of laps (race ignored).");
                    ++this.errors;
                    return -2;
                }

                // if 'other...' is selected, then we'll need to get the specified value
                if (races[id].laps == '[other]') {
                    races[id].laps = parseInt(document.getElementById("race_" + id + "_lapsOther").value);
                    if (isNaN(races[id].laps)) {
                        this.errormsg += fatalError("Critical error detected in race " + races[id].name + " (" + id + "): No amount of laps set (race ignored).");
                        ++this.errors;
                        return -3;
                    }
                }
            }

            // VERSION
            races[id].version = document.getElementById("race_" + id + "_version").value.replace(/^\s+|\s+$/g, '');

            // DEFAULT CHECKPOINT OBJECTS
            {
                // Get the default checkpoint objects
                races[id].chpObjects['start'] = document.getElementById("race_" + id + "_defaultStart").value.replace(/^\s+|\s+$/g, '');
                races[id].chpObjects['chp'] = document.getElementById("race_" + id + "_defaultCheckpoint").value.replace(/^\s+|\s+$/g, '');
                races[id].chpObjects['finish'] = document.getElementById("race_" + id + "_defaultFinish").value.replace(/^\s+|\s+$/g, '');

                // check for empty objects
                if (races[id].chpObjects['start'] == '' || races[id].chpObjects['start'] == '[default]')
                    races[id].chpObjects['start'] = "chp-start";
                if (races[id].chpObjects['chp'] == '' || races[id].chpObjects['chp'] == '[default]')
                    races[id].chpObjects['chp'] = "chp-checkpoint";
                if (races[id].chpObjects['finish'] == '' || races[id].chpObjects['finish'] == '[default]')
                    races[id].chpObjects['finish'] = "chp-start";
            }

            // CHECKPOINTS
            {
                // get checkpoints
                var free_checkpoint = 0;
                var chps = document.getElementById("race_" + id + "_checkpoints").value;
                chps = chps.split(/\r?\n/);
                for (var i in chps) {
                    // trim the string
                    var line = chps[i].replace(/^\s+|\s+$/g, '');

                    // Ignore comments and empty lines
                    if (line == "" || line[0] == ';' || line[0] == '/')
                        continue;

                    // Split the line on commas
                    var lineParts = line.split(',');

                    // Length must at least be 6
                    if (lineParts.length < 6) {
                        if (chps[i].search("IGNORED") < 0)
                            chps[i] += "   <- IGNORED (syntax error: not enough parameters)";

                        this.errormsg += normalError("Syntax error detected in race " + races[id].name + " (" + id + ") at line " + (parseInt(i) + 1) + " of the checkpoints field (not enough parameters, line ignored).");
                        ++this.errors;
                        continue;
                    }

                    // check if the first 6 parts are numbers
                    var problem = false;
                    for (var k = 0; k < 6; ++k) {
                        if (isNaN(parseFloat(lineParts[k]))) {
                            if (chps[i].search("IGNORED") < 0)
                                chps[i] += "   <- IGNORED (syntax error: parameter" + (parseInt(k) + 1) + ")";

                            this.errormsg += normalError("Syntax error detected in race " + races[id].name + " (" + id + ") at line " + (parseInt(i) + 1) + " of the checkpoints field (line ignored).");
                            ++this.errors;
                            problem = true;
                            break;
                        }
                    }
                    if (problem)
                        continue;

                    // assign the numbers to the checkpoint variable
                    races[id].checkpoints[free_checkpoint] = {
                        'posx': parseFloat(lineParts[0]).toString(),
                        'posy': parseFloat(lineParts[1]).toString(),
                        'posz': parseFloat(lineParts[2]).toString(),
                        'rotx': parseFloat(lineParts[3]).toString(),
                        'roty': parseFloat(lineParts[4]).toString(),
                        'rotz': parseFloat(lineParts[5]).toString(),
                        'cobj': '[default]'
                    }

                    // Allways add commas
                    for (var k in races[id].checkpoints[free_checkpoint]) {
                        if (k != 'cobj' && k != 'cmsg_handler' && races[id].checkpoints[free_checkpoint][k].search(/\./) < 0)
                            races[id].checkpoints[free_checkpoint][k] += ".0";
                    }

                    // handle the optional object
                    if (lineParts.length > 6) {
                        var tmpArray = lineParts[6].replace(/^\s+|\s+$/g, '').split(' ');
                        if (tmpArray.length > 0)
                            races[id].checkpoints[free_checkpoint]['cobj'] = tmpArray[0];
                    }

                    // Fix empty objects
                    if (races[id].checkpoints[free_checkpoint]['cobj'] == '') {
                        races[id].checkpoints[free_checkpoint]['cobj'] = '[default]';
                    }

                    ++free_checkpoint;
                }

                // Put the checkpointlist in the textarea again
                chps = chps.join('\r\n');
                document.getElementById("race_" + id + "_checkpoints").value = chps;

                // We need at least 2 checkpoints
                if (free_checkpoint < 2) {
                    this.errormsg += fatalError("Critical error detected in race " + races[id].name + " (" + id + "): Not enough checkpoints (2 required, race ignored).");
                    ++this.errors;
                    return -4;
                }

                // Replace all default objects by the correct objects
                for (var i in races[id].checkpoints) {
                    if (races[id].checkpoints[i]['cobj'] == '[default]') {

                        if (i == 0)
                            races[id].checkpoints[i]['cobj'] = races[id].chpObjects['start'];
                        else if ((i == (free_checkpoint - 1)) && (races[id].laps == 'races.LAPS_NoLaps'))
                            races[id].checkpoints[i]['cobj'] = races[id].chpObjects['finish'];
                        else
                            races[id].checkpoints[i]['cobj'] = races[id].chpObjects['chp'];
                    }
                }
            }

            // DEFAULT ABORT OBJECTS
            {
                // Get the default checkpoint objects
                races[id].abortObject = document.getElementById("race_" + id + "_defaultAbort").value.replace(/^\s+|\s+$/g, '');

                // check for empty objects
                if (races[id].abortObject == '' || races[id].abortObject == '[default]')
                    races[id].abortObject = "trucktrigger";
            }

            // DEFAULT ABORT MESSAGE
            {
                // Get the default abort message
                var defaultAbortMessage = document.getElementById("race_" + id + "_abortMessage").value.replace(/^\s+|\s+$/g, '');

                // check for empty messages
                if (defaultAbortMessage == '' || defaultAbortMessage == '[default]')
                    defaultAbortMessage = "[noMessage]";
            }

            // ABORT POINTS
            {
                // get race abort points
                var free_raceAbort = 0;
                var chps = document.getElementById("race_" + id + "_raceAbort").value;
                chps = chps.split(/\r?\n/);

                var message = defaultAbortMessage;
                var abortMessageHander = -1;
                for (var k in abortMessageHandlers) {
                    if (abortMessageHandlers[k] == defaultAbortMessage)
                        abortMessageHander = k;
                }
                if (abortMessageHander == -1) {
                    abortMessageHandlers[free_abortMessageHandler] = defaultAbortMessage;
                    abortMessageHander = free_abortMessageHandler;
                    ++free_abortMessageHandler;
                }

                for (var i in chps) {
                    // trim the string
                    var line = chps[i].replace(/^\s+|\s+$/g, '');

                    // Ignore comments and empty lines
                    if (line == "" || line[0] == ';' || line[0] == '/')
                        continue;

                    // check for the message variable
                    if (line.substr(0, 7) == 'MESSAGE') {
                        var msg = line.substr(7);
                        msg = msg.replace(/^\s+/g, '');
                        if (msg[0] != '=') {
                            this.errormsg += normalError("Syntax error detected in race " + races[id].name + " (" + id + ") at line " + (parseInt(i) + 1) + " of the race abort points field (expected '=' after 'MESSAGE', line ignored).");
                            ++this.errors;
                            continue;
                        }
                        var msg = msg.substr(1);
                        msg = msg.replace(/^\s+/g, '');

                        if (msg == '')
                            msg = '[noMessage]';
                        else if (msg == '[default]')
                            msg = defaultAbortMessage;

                        abortMessageHander = -1;
                        for (var k in abortMessageHandlers) {
                            if (abortMessageHandlers[k] == msg) {
                                abortMessageHander = k;
                                break;
                            }
                        }
                        if (abortMessageHander == -1) {
                            abortMessageHandlers[free_abortMessageHandler] = msg;
                            abortMessageHander = free_abortMessageHandler;
                            ++free_abortMessageHandler;
                        }
                        continue;
                    }

                    // Split the line on commas
                    var lineParts = line.split(',');

                    // Length must at least be 6
                    if (lineParts.length < 6) {
                        if (chps[i].search("IGNORED") < 0)
                            chps[i] += "   <- IGNORED (syntax error: not enough parameters)";

                        this.errormsg += normalError("Syntax error detected in race " + races[id].name + " (" + id + ") at line " + (parseInt(i) + 1) + " of the race abort points field (not enough parameters, line ignored).");
                        ++this.errors;
                        continue;
                    }

                    // check if the first 6 parts are numbers
                    var problem = false;
                    for (var k = 0; k < 6; ++k) {
                        if (isNaN(parseFloat(lineParts[k]))) {
                            if (chps[i].search("IGNORED") < 0)
                                chps[i] += "   <- IGNORED (syntax error: parameter" + (parseInt(k) + 1) + ")";

                            this.errormsg += normalError("Syntax error detected in race " + races[id].name + " (" + id + ") at line " + (parseInt(i) + 1) + " of the race abort points field (line ignored).");
                            ++this.errors;
                            problem = true;
                            break;
                        }
                    }
                    if (problem)
                        continue;

                    // assign the numbers to the checkpoint variable
                    races[id].raceAbortPoints[free_raceAbort] = {
                        'posx': parseFloat(lineParts[0]).toString(),
                        'posy': parseFloat(lineParts[1]).toString(),
                        'posz': parseFloat(lineParts[2]).toString(),
                        'rotx': parseFloat(lineParts[3]).toString(),
                        'roty': parseFloat(lineParts[4]).toString(),
                        'rotz': parseFloat(lineParts[5]).toString(),
                        'cobj': '[default]',
                        'cmsg_handler': abortMessageHander
                    }

                    // Allways add commas
                    for (var k in races[id].raceAbortPoints[free_raceAbort]) {
                        if (k != 'cobj' && k != 'cmsg_handler' && races[id].raceAbortPoints[free_raceAbort][k].search(/\./) < 0)
                            races[id].raceAbortPoints[free_raceAbort][k] += ".0";
                    }

                    // handle the optional object
                    if (lineParts.length > 6) {
                        var tmpArray = lineParts[6].replace(/^\s+|\s+$/g, '').split(' ');
                        if (tmpArray.length > 0)
                            races[id].raceAbortPoints[free_raceAbort]['cobj'] = tmpArray[0];
                    }

                    // Fix empty objects
                    if (races[id].raceAbortPoints[free_raceAbort]['cobj'] == '') {
                        races[id].raceAbortPoints[free_raceAbort]['cobj'] = '[default]';
                    }

                    ++free_raceAbort;
                }

                // Put the checkpointlist in the textarea again
                chps = chps.join('\r\n');
                document.getElementById("race_" + id + "_raceAbort").value = chps;

                // Replace all default objects by the correct objects
                for (var i in races[id].raceAbortPoints) {
                    if (races[id].raceAbortPoints[i]['cobj'] == '[default]') {
                        races[id].raceAbortPoints[i]['cobj'] = races[id].abortObject;
                    }
                }
            }

            // OPTIONS
            for (var setting in races[id].options) {
                races[id].options[setting] = document.getElementById('race_' + id + '_' + setting).checked ? 'true' : 'false';
            }

            // PENALTY SECONDS
            {
                // Get the penalty seconds
                races[id].penaltySeconds = parseInt(document.getElementById("race_" + id + "_penaltySeconds").value);

                if (isNaN(races[id].penaltySeconds) || races[id].penaltySeconds < 0) {
                    this.errormsg += normalError("Error detected in race " + races[id].name + " (" + id + "): penalty seconds should be a positive integer number (using 0 seconds).");
                    ++this.errors;
                    races[id].penaltySeconds = 0
                }
            }

            // PENALTY MESSAGE
            {
                // Get the penalty message
                races[id].penaltyEventMessage = document.getElementById("race_" + id + "_penaltyMessage").value.replace(/^\s+|\s+$/g, '');

                // check for empty messages
                if (races[id].penaltyEventMessage == '' || races[id].penaltyEventMessage == '[default]')
                    races[id].penaltyEventMessage = "[noMessage]";
            }

            return 1;
        }

        this.buildRace = function (id) {
            var main = '    // MAIN SECTION ' + id + ' START\r\n';
            var general = '// GENERAL SECTION ' + id + ' START\r\n';
            var raceStart = '   // RACESTART SECTION ' + id + ' START\r\n';
            var penaltyEvent = '    // PENALTYEVENT SECTION ' + id + ' START\r\n';

            // The race ID will be a global variable
            var raceID = 'race_' + id + '_' + races[id].name.replace(/[^a-zA-Z0-9]/g, '_') + '_ID';
            general += 'int ' + raceID + ';\r\n';

            // Start adding the race
            var script = "  {VAR_RACE_ID} = races.addNewEmptyRace();\r\n";
            script += " races.setRaceName({VAR_RACE_ID}, \"{VAR_RACE_NAME}\");\r\n";
            script += " races.setLaps({VAR_RACE_ID}, {VAR_RACE_LAPS});\r\n";
            main += script.replace(/{VAR_RACE_ID}/g, raceID).replace(/{VAR_RACE_NAME}/g, races[id].name).replace(/{VAR_RACE_LAPS}/g, races[id].laps);

            main += '   array<array<double>> race_' + id + '_coords = {\r\n';
            for (var i in races[id].checkpoints) {
                if (i == (races[id].checkpoints.length - 1))
                    main += '       {' + races[id].checkpoints[i]['posx'] + ', ' + races[id].checkpoints[i]['posy'] + ', ' + races[id].checkpoints[i]['posz'] + ', ' + races[id].checkpoints[i]['rotx'] + ', ' + races[id].checkpoints[i]['roty'] + ', ' + races[id].checkpoints[i]['rotz'] + '}\r\n';
                else
                    main += '       {' + races[id].checkpoints[i]['posx'] + ', ' + races[id].checkpoints[i]['posy'] + ', ' + races[id].checkpoints[i]['posz'] + ', ' + races[id].checkpoints[i]['rotx'] + ', ' + races[id].checkpoints[i]['roty'] + ', ' + races[id].checkpoints[i]['rotz'] + '},\r\n';
            }
            main += '   };\r\n';
            for (var i in races[id].checkpoints) {
                main += '   races.addCheckpoint(' + raceID + ', ' + i + ', \"' + races[id].checkpoints[i]['cobj'] + '\", race_' + id + '_coords[' + i + ']);\r\n';
            }

            // set the race version
            if (races[id].version != '')
                main += '   races.setVersion(' + raceID + ', "' + races[id].version + '");\r\n';

            // penalty seconds
            if (races[id].penaltySeconds > 0)
                main += '   races.setPenaltyTime(' + raceID + ', ' + races[id].penaltySeconds + ');\r\n';

            // penalty message
            if (races[id].penaltyEventMessage != '[noMessage]') {
                penaltyEvent += '   if( raceID == ' + raceID + ' )\r\n';
                penaltyEvent += '   {\r\n';
                penaltyEvent += '       races.message("' + races[id].penaltyEventMessage + '", "lightning.png");\r\n';
                penaltyEvent += '   }\r\n';
            }

            // race abort points
            for (var i in races[id].raceAbortPoints) {
                main += '   races.addCancelPoint(' + raceID + ', \"' + races[id].raceAbortPoints[i]['cobj'] + '\", vector3(' + races[id].raceAbortPoints[i]['posx'] + 'f, ' + races[id].raceAbortPoints[i]['posy'] + 'f, ' + races[id].raceAbortPoints[i]['posz'] + 'f), vector3(' + races[id].raceAbortPoints[i]['rotx'] + 'f, ' + races[id].raceAbortPoints[i]['roty'] + 'f, ' + races[id].raceAbortPoints[i]['rotz'] + 'f)';

                if (abortMessageHandlers[races[id].raceAbortPoints[i]['cmsg_handler']] != '[noMessage]')
                    main += ', on_RaceAbort_event' + races[id].raceAbortPoints[i]['cmsg_handler'] + ');\r\n';
                else
                    main += ');\r\n';
                // main += '    races.addCancelPoint('+raceID+', \"'+races[id].raceAbortPoints[i]['cobj']+'\", vector3('+races[id].raceAbortPoints[i]['posx']+'f, '+races[id].raceAbortPoints[i]['posy']+'f, '+races[id].raceAbortPoints[i]['posz']+'f), vector3('+races[id].raceAbortPoints[i]['rotx']+'f, '+races[id].raceAbortPoints[i]['roty']+'f, '+races[id].raceAbortPoints[i]['rotz']+'f), on_RaceAbort_event'+races[id].raceAbortPoints[i]['cmsg_handler']+');\r\n';
            }

            // Tell the races script that the race is completed now
            main += '   races.finalize(' + raceID + ');\r\n';

            // set the options
            raceStart += '  if( raceID == ' + raceID + ' )\r\n';
            raceStart += '  {\r\n';
            for (var setting in races[id].options) {
                raceStart += '      races.' + setting + ' = ' + races[id].options[setting] + ';\r\n';
            }
            raceStart += '  }\r\n';

            main += '   // MAIN SECTION ' + id + ' END\r\n';
            general += '// GENERAL SECTION ' + id + ' END\r\n';
            raceStart += '  // RACESTART SECTION ' + id + ' END\r\n';
            penaltyEvent += '   // PENALTYEVENT SECTION ' + id + ' END\r\n';

            this.scriptSections['main'] += '\r\n' + main + '\r\n';
            this.scriptSections['general'] += '\r\n' + general + '\r\n';
            this.scriptSections['RaceStart'] += '\r\n' + raceStart + '\r\n';
            this.scriptSections['PenaltyEvent'] += '\r\n' + penaltyEvent + '\r\n';

            return 1;
        }

        this.generate = function () {
            var r;
            this.scriptSections['main'] = '';
            this.scriptSections['general'] = '';
            this.scriptSections['RaceStart'] = '';
            this.scriptSections['PenaltyEvent'] = '';
            abortMessageHandlers.length = 0;
            abortMessageHandlers = new Array();
            free_abortMessageHandler = 0;

            // build all the races
            for (var id in races) {
                if (races[id].used) {
                    r = this.generateRace(id);
                }
            }

            // get the terrain file setting
            var terrnFile = document.getElementById("general_terrnFilename").value.replace(/^\s+|\s+$/g, '');

            // DEFAULT ABORT MESSAGE
            {
                // Get the default abort message
                var defaultAbortMessage = document.getElementById("race_-1_abortMessage").value.replace(/^\s+|\s+$/g, '');

                // check for empty messages
                if (defaultAbortMessage == '' || defaultAbortMessage == '[default]')
                    defaultAbortMessage = "[noMessage]";
            }

            // ABORT POINTS
            {
                // get race abort points
                var free_raceAbort = 0;
                var abortObject = document.getElementById("race_-1_defaultAbort").value.replace(/^\s+|\s+$/g, '');

                // check for empty objects
                if (abortObject == '' || abortObject == '[default]')
                    abortObject = "trucktrigger";

                var raceAbortPoints = new Array();
                var chps = document.getElementById("race_-1_raceAbort").value;
                chps = chps.split(/\r?\n/);

                var message = defaultAbortMessage;
                var abortMessageHander = -1;
                for (var k in abortMessageHandlers) {
                    if (abortMessageHandlers[k] == defaultAbortMessage)
                        abortMessageHander = k;
                }
                if (abortMessageHander == -1) {
                    abortMessageHandlers[free_abortMessageHandler] = defaultAbortMessage;
                    abortMessageHander = free_abortMessageHandler;
                    ++free_abortMessageHandler;
                }

                for (var i in chps) {
                    // trim the string
                    var line = chps[i].replace(/^\s+|\s+$/g, '');

                    // Ignore comments and empty lines
                    if (line == "" || line[0] == ';' || line[0] == '/')
                        continue;

                    // check for the message variable
                    if (line.substr(0, 7) == 'MESSAGE') {
                        var msg = line.substr(7);
                        msg = msg.replace(/^\s+/g, '');
                        if (msg[0] != '=') {
                            this.errormsg += normalError("Syntax error detected at line " + (parseInt(i) + 1) + " of the general race abort points field (expected '=' after 'MESSAGE', line ignored).");
                            ++this.errors;
                            continue;
                        }
                        var msg = msg.substr(1);
                        msg = msg.replace(/^\s+/g, '');

                        if (msg == '')
                            msg = '[noMessage]';
                        else if (msg == '[default]')
                            msg = defaultAbortMessage;

                        abortMessageHander = -1;
                        for (var k in abortMessageHandlers) {
                            if (abortMessageHandlers[k] == msg) {
                                abortMessageHander = k;
                                break;
                            }
                        }
                        if (abortMessageHander == -1) {
                            abortMessageHandlers[free_abortMessageHandler] = msg;
                            abortMessageHander = free_abortMessageHandler;
                            ++free_abortMessageHandler;
                        }
                        continue;
                    }

                    // Split the line on commas
                    var lineParts = line.split(',');

                    // Length must at least be 6
                    if (lineParts.length < 6) {
                        if (chps[i].search("IGNORED") < 0)
                            chps[i] += "   <- IGNORED (syntax error: not enough parameters)";

                        this.errormsg += normalError("Syntax error detected at line " + (parseInt(i) + 1) + " of the general race abort points field (not enough parameters, line ignored).");
                        ++this.errors;
                        continue;
                    }

                    // check if the first 6 parts are numbers
                    var problem = false;
                    for (var k = 0; k < 6; ++k) {
                        if (isNaN(parseFloat(lineParts[k]))) {
                            if (chps[i].search("IGNORED") < 0)
                                chps[i] += "   <- IGNORED (syntax error: parameter" + (parseInt(k) + 1) + ")";

                            this.errormsg += normalError("Syntax error detected at line " + (parseInt(i) + 1) + " of the general race abort points field (line ignored).");
                            ++this.errors;
                            problem = true;
                            break;
                        }
                    }
                    if (problem)
                        continue;

                    // assign the numbers to the checkpoint variable
                    raceAbortPoints[free_raceAbort] = {
                        'posx': parseFloat(lineParts[0]).toString(),
                        'posy': parseFloat(lineParts[1]).toString(),
                        'posz': parseFloat(lineParts[2]).toString(),
                        'rotx': parseFloat(lineParts[3]).toString(),
                        'roty': parseFloat(lineParts[4]).toString(),
                        'rotz': parseFloat(lineParts[5]).toString(),
                        'cobj': '[default]',
                        'cmsg_handler': abortMessageHander
                    }

                    // Allways add commas
                    for (var k in raceAbortPoints[free_raceAbort]) {
                        if (k != 'cobj' && k != 'cmsg_handler' && raceAbortPoints[free_raceAbort][k].search(/\./) < 0)
                            raceAbortPoints[free_raceAbort][k] += ".0";
                    }

                    // handle the optional object
                    if (lineParts.length > 6) {
                        var tmpArray = lineParts[6].replace(/^\s+|\s+$/g, '').split(' ');
                        if (tmpArray.length > 0)
                            raceAbortPoints[free_raceAbort]['cobj'] = tmpArray[0];
                    }

                    // Fix empty objects
                    if (raceAbortPoints[free_raceAbort]['cobj'] == '') {
                        raceAbortPoints[free_raceAbort]['cobj'] = '[default]';
                    }

                    ++free_raceAbort;
                }

                // Put the checkpointlist in the textarea again
                chps = chps.join('\r\n');
                document.getElementById("race_-1_raceAbort").value = chps;

                // Replace all default objects by the correct objects
                for (var i in raceAbortPoints) {
                    if (raceAbortPoints[i]['cobj'] == '[default]') {
                        raceAbortPoints[i]['cobj'] = abortObject;
                    }
                }

                if (free_raceAbort > 0) {
                    // build the race abort points
                    this.scriptSections['main'] += '\r\n';
                    this.scriptSections['main'] += '    // MAIN SECTION GENERAL START\r\n';
                    for (var i in raceAbortPoints) {
                        this.scriptSections['main'] += '    races.addCancelPoint(-1, \"' + raceAbortPoints[i]['cobj'] + '\", vector3(' + raceAbortPoints[i]['posx'] + 'f, ' + raceAbortPoints[i]['posy'] + 'f, ' + raceAbortPoints[i]['posz'] + 'f), vector3(' + raceAbortPoints[i]['rotx'] + 'f, ' + raceAbortPoints[i]['roty'] + 'f, ' + raceAbortPoints[i]['rotz'] + 'f)';

                        if (abortMessageHandlers[raceAbortPoints[i]['cmsg_handler']] != '[noMessage]')
                            this.scriptSections['main'] += ', on_RaceAbort_event' + raceAbortPoints[i]['cmsg_handler'] + ');\r\n';
                        else
                            this.scriptSections['main'] += ');\r\n';
                    }
                    this.scriptSections['main'] += '    // MAIN SECTION GENERAL END\r\n';
                    this.scriptSections['main'] += '\r\n';
                }
            }

            // build abort point functions
            this.scriptSections['general'] += '\r\n// GENERAL SECTION GENERAL START\r\n';
            for (var i in abortMessageHandlers) {
                if (abortMessageHandlers[i] == '[noMessage]')
                    continue;

                this.scriptSections['general'] += '\r\n';
                this.scriptSections['general'] += 'void on_RaceAbort_event' + i + '(dictionary@ event)\r\n';
                this.scriptSections['general'] += '{\r\n';
                this.scriptSections['general'] += ' races.message("' + abortMessageHandlers[i] + '", "stop.png");\r\n';
                this.scriptSections['general'] += '}\r\n';
            }
            this.scriptSections['general'] += '\r\n// GENERAL SECTION GENERAL END\r\n';

            var script = "";

            if (this.scriptSections['main'] == '' && this.scriptSections['general'] == '' && this.scriptSections['RaceStart'] == '') {
                this.errormsg += fatalError("Failed to generate a script file (no races to create).");
                ++this.errors;
                script = '// Failed to generate the script.';
            } else {
                if (terrnFile != '')
                    script += "// Filename: " + terrnFile + "\r\n";
                script += "// This file was generated using the docs.rigsofrods.org race script generator.\r\n";
                script += "#include \"base.as\";\r\n";
                script += "#include \"races.as\";\r\n";
                script += "\r\n";
                script += "racesManager races();\r\n";
                script += "\r\n";
                script += this.scriptSections['general'] + "\r\n";
                script += "\r\n";

                // main
                script += "void main()\r\n";
                script += "{\r\n";
                script += " races.setCallback('RaceStart', on_RaceStart_event);\r\n";
                script += " races.setCallback('PenaltyEvent', on_PenaltyEvent_event);\r\n";
                script += " races.showCheckPointInfoWhenNotInRace = " + (document.getElementById('race_-1_showCheckPointInfoWhenNotInRace').checked ? 'true' : 'false') + ";\r\n";
                script += this.scriptSections['main'] + "\r\n";
                script += "}\r\n";
                script += "\r\n";

                // on_RaceStart_event
                script += "void on_RaceStart_event(dictionary@ event)\r\n";
                script += "{\r\n";
                script += " int raceID;\r\n";
                script += " event.get('raceID', raceID);\r\n";
                script += "\r\n";
                script += this.scriptSections['RaceStart'] + "\r\n";
                script += "}\r\n";
                script += "\r\n";

                // on_PenaltyEvent_event
                script += "void on_PenaltyEvent_event(dictionary@ event)\r\n";
                script += "{\r\n";
                script += " int raceID;\r\n";
                script += " event.get('raceID', raceID);\r\n";
                script += "\r\n";
                script += this.scriptSections['PenaltyEvent'] + "\r\n";
                script += "}\r\n";
                script += "\r\n";

                // eventCallback
                script += "void eventCallback(int eventnum, int value)\r\n";
                script += "{\r\n";
                script += " races.eventCallback(eventnum, value);\r\n";
                script += "}\r\n";
                script += "\r\n";

                // on_RaceAbort_event
                //script += "void on_RaceAbort_event(dictionary@ event)\r\n";
                //script += "{\r\n";
                //script += "   int raceID;\r\n";
                //script += "   event.get('raceID', raceID);\r\n";
                //script += "\r\n";
                //script += this.scriptSections['RaceAbort']+"\r\n";
                //script += "}\r\n";
                //script += "\r\n";
            }

            document.getElementById("scriptResult").value = script;
            if (this.errors == 0) {
                this.errormsg += noError("Build successful! (no errors occurred)");
            }
            document.getElementById("errorMessageField").innerHTML = this.errormsg;
            this.errormsg = "";
            if (this.errors > 0) {
                alert("Generated script file with " + this.errors + " errors.");
                this.errors = 0;
            }
        }
    }

    function race(id) {
        this.id = id;
        this.used = true;
        this.name = '';
        this.laps = -1;
        this.version = '';
        this.options = {
            'obligatedFinish': 'false',
            'showTimeDiff': 'true',
            'showBestLap': 'true',
            'showBestRace': 'true',
            'submitScore': 'true',
            'silentMode': 'false',
            //'allowVehicleChanging': 'false',
            //'abortOnVehicleExit':   'false',
            //'showCheckPointInfoWhenNotInRace': 'false',
            'restartRaceOnStart': 'true'
        };
        this.penaltyEventMessage = '';
        this.penaltySeconds = 0;

        this.chpObjects = {
            'start': 'chp-start',
            'chp': 'chp-checkpoint',
            'finish': 'chp-start'
        };
        this.checkpoints = new Array();

        this.abortObject = 'trucktrigger';
        this.raceAbortPoints = new Array();
        this.raceAbortMessage = '[noMessage]';
        this.lastAbortMessage = '[noMessage]';
    }


    // unused
    function on_raceCount_change(select) {
        var newRaceCount = parseInt(select.options[select.selectedIndex].value);
        var form = document.getElementById("formTemplate").innerHTML;
        var formDiv = document.getElementById("formDiv");
        var raceCount = getRaceCount

        for (var i = 1; i <= newRaceCount - raceCount; ++i) {
            formDiv.innerHTML += form.replace(/{RACE_NUMBER}/g, (i + raceCount));
        }

        /*for( var i = 1; i <= raceCount-newRaceCount; ++i )
        {
            formDiv.removeChild(document.getElementById(
            innerHTML += form.replace("{RACE_NUMBER}", (i+raceCount));
        }

        race_{RACE_NUMBER}*/

        raceCount = newRaceCount;
    }

    function on_addRace_click() {
        var form = document.getElementById("formTemplate").innerHTML;
        form = form.replace(/{RACE_NUMBER}/g, free_race);
        var formDiv = document.getElementById("formDiv");

        var newdiv = document.createElement('div');
        newdiv.setAttribute('id', 'race_' + free_race + '_containerDiv');
        newdiv.innerHTML = form;
        formDiv.appendChild(newdiv);

        //formDiv.innerHTML += form.replace(/{RACE_NUMBER}/g, free_race);
        races[free_race] = new race(free_race);
        ++free_race;
    }

    function on_option_change(name, racenum) {
        var checkObj = document.getElementById("race_" + racenum + "_" + name);
        var infoObj = document.getElementById("race_" + racenum + "_" + name + "_info");

        if (name == "obligatedFinish") {
            if (checkObj.checked)
                infoObj.innerHTML = "[Current setting: If you drive through the start checkpoint of a race while already in another race, the current race will continue and the other race start line will be ignored.]"
            else
                infoObj.innerHTML = "[Current setting: If you drive through the start checkpoint of a race while already in another race, the current race will be aborted and the other race will start.]";
        } else if (name == "showTimeDiff") {
            if (checkObj.checked)
                infoObj.innerHTML = "[Current setting: Show + or - [best time minus current time] when you pass a checkpoint.]"
            else
                infoObj.innerHTML = "[Current setting: Only show the current time when you pass a checkpoint.]";
        } else if (name == "showBestLap") {
            if (checkObj.checked)
                infoObj.innerHTML = "[Current setting: If a race is started or a new best lap is set, the best lap will be shown.]"
            else
                infoObj.innerHTML = "[Current setting: Best lap times won't be shown to the user.]";
        } else if (name == "showBestRace") {
            if (checkObj.checked)
                infoObj.innerHTML = "[Current setting: If a race is started or a new best race time is set, the best race time will be shown.]"
            else
                infoObj.innerHTML = "[Current setting: Best race times won't be shown to the user.]";
        } else if (name == "submitScore") {
            if (checkObj.checked)
                infoObj.innerHTML = "[Current setting: If the user has a new best lap time or new best race time, then this time is submitted to the master server.]"
            else
                infoObj.innerHTML = "[Current setting: Race and lap times won't be sent to the master server.]";
        } else if (name == "silentMode") {
            if (checkObj.checked)
                infoObj.innerHTML = "[Current setting: No info will be shown to the user, except for the timer.]"
            else
                infoObj.innerHTML = "[Current setting: The user will be informed about running races.]";
        } else if (name == "showCheckPointInfoWhenNotInRace") {
            if (checkObj.checked)
                infoObj.innerHTML = "[Current setting: If the user drives through a checkpoint of a race that isn't running, a message will be shown, saying \"this is checkpoint X of race myRaceName\".]"
            else
                infoObj.innerHTML = "[Current setting: If the user drives through a (not start line) checkpoint of a race that isn't running, nothing will happen.]";
        } else if (name == "restartRaceOnStart") {
            if (checkObj.checked)
                infoObj.innerHTML = "[Current setting: The race will be restarted when you pass the start line of the same race.]"
            else
                infoObj.innerHTML = "[Current setting: The race will continue to run without resetting the time when you pass the start line of the same race.]";
        }
    }

    function on_closeIcon_click(racenum) {
        var formDiv = document.getElementById("formDiv");
        var obj = document.getElementById("race_" + racenum + "_containerDiv");
        formDiv.removeChild(obj);
        races[racenum].used = false;
        reUseRaceNumbers();
    }

    function on_checkpointField_focus(obj, defaultText, defaultValue) {
        checkpointFieldFocussed = true;
        if (obj.value == defaultText)
            obj.value = defaultValue;
        obj.select();
    }

    function on_checkpointField_blur(obj, defaultText, defaultValue) {
        checkpointFieldFocussed = false;
        if (obj.value == defaultValue)
            obj.value = defaultText;
    }

    function on_checkpointField_mouseOver(obj, defaultText, defaultValue) {
        if (checkpointFieldFocussed)
            return;
        if (obj.value == defaultText)
            obj.value = defaultValue;
    }

    function on_checkpointField_mouseOut(obj, defaultText, defaultValue) {
        if (checkpointFieldFocussed)
            return;
        if (obj.value == defaultValue)
            obj.value = defaultText;
    }

    function on_fieldAdd_click(racenum, idPrefix, fieldID) {

        // check the position and rotation
        var fields = new Array('posx', 'posy', 'posz', 'rotx', 'roty', 'rotz');
        var defaults = new Array('pos x', 'pos y', 'pos z', 'rot x', 'rot y', 'rot z');
        var texts = new Array('position x', 'position y', 'position z', 'rotation x', 'rotation y', 'rotation z');
        var coords = new Array();

        for (var i in fields) {
            var cd = document.getElementById("race_" + racenum + "_" + idPrefix + '_' + fields[i]).value;
            // http://developer.loftdigital.com/blog/trim-a-string-in-javascript
            cd = cd.replace(/^\s+|\s+$/g, '')
            if (cd == defaults[i])
                cd = "0.0";
            else if (isNaN(parseFloat(document.getElementById("race_" + racenum + "_" + idPrefix + '_' + fields[i]).value))) {
                alert("Unable to add object: '" + texts[i] + "' is not a number!");
                return;
            }
            coords[i] = parseFloat(cd);
        }

        // check the checkpoint object
        var cobj = document.getElementById("race_" + racenum + "_" + idPrefix + "_cobj").value;
        // http://developer.loftdigital.com/blog/trim-a-string-in-javascript
        cobj = cobj.replace(/^\s+|\s+$/g, '');
        if (cobj == "" || cobj == "object") {
            cobj = "[default]";
        }

        var line = "\r\n";

        if (idPrefix == 'raceAbort') {
            // check the race abort message
            var cmsg = document.getElementById("race_" + racenum + "_" + idPrefix + "_cmsg").value;
            // http://developer.loftdigital.com/blog/trim-a-string-in-javascript
            cmsg = cmsg.replace(/^\s+|\s+$/g, '');
            if (cmsg == "" || cmsg == "message to show") {
                cmsg = "[default]";
            }

            var lastCmsg;
            if (racenum == -1) {
                lastCmsg = lastAbortMessage;
                lastAbortMessage = cmsg;
            } else {
                lastCmsg = races[racenum].lastAbortMessage
                races[racenum].lastAbortMessage = cmsg;
            }

            if (lastCmsg != cmsg)
                line += 'MESSAGE = ' + cmsg + '\r\n';

            if (cmsg == "[default]")
                document.getElementById("race_" + racenum + "_" + idPrefix + "_cmsg").value = "message to show";
        }

        // Add the line to the textarea
        for (var i in coords) {
            if (coords[i].toString().search(/\./) >= 0)
                line += coords[i] + ", ";
            else
                line += coords[i] + ".0, ";
        }
        line += cobj;
        document.getElementById("race_" + racenum + "_" + fieldID).value += line;

        // reset all the default values
        document.getElementById("race_" + racenum + "_" + idPrefix + "_posx").value = "pos x";
        document.getElementById("race_" + racenum + "_" + idPrefix + "_posy").value = "pos y";
        document.getElementById("race_" + racenum + "_" + idPrefix + "_posz").value = "pos z";
        document.getElementById("race_" + racenum + "_" + idPrefix + "_rotx").value = "rot x";
        document.getElementById("race_" + racenum + "_" + idPrefix + "_roty").value = "rot y";
        document.getElementById("race_" + racenum + "_" + idPrefix + "_rotz").value = "rot z";
        if (cobj == "[default]")
            document.getElementById("race_" + racenum + "_" + idPrefix + "_cobj").value = "object";

        if (idPrefix == "chpAdd")
            drawPreview(racenum);
    }

    function reUseRaceNumbers() {
        for (var i = free_race - 1; i >= 0 && races[i].used == false; --i) {
            --free_race;
        }
    }

    function init() {
        for (var i = 0; i < 200; ++i) {

        }
        on_addRace_click();
    }

    function on_generate_click() {
        myScriptFile.generate();
    }

    function on_laps_change(obj, racenum) {
        if (obj.options[obj.selectedIndex].value == "other...")
            document.getElementById("race_" + racenum + "_lapsOther").style.display = "inline-table";
        else
            document.getElementById("race_" + racenum + "_lapsOther").style.display = "none";

        if (obj.options[obj.selectedIndex].value.substr(0, 7) == "No laps")
            document.getElementById("race_" + racenum + "_defaultFinish").disabled = false;
        else
            document.getElementById("race_" + racenum + "_defaultFinish").disabled = true;
    }

    function enforceDefault(obj, defaultValue) {
        if (obj.value.replace(/^\s+|\s+$/g, '') == '')
            obj.value = defaultValue;
    }

    function drawPreview(id) {

        // get the checkpoints into an array
        var checkpoints = [];
        {
            // get checkpoints
            var free_checkpoint = 0;
            var chps = document.getElementById("race_" + id + "_checkpoints").value;
            chps = chps.split(/\r?\n/);
            for (var i in chps) {
                // trim the string
                var line = chps[i].replace(/^\s+|\s+$/g, '');

                // Ignore comments and empty lines
                if (line == "" || line[0] == ';' || line[0] == '/')
                    continue;

                // Split the line on commas
                var lineParts = line.split(',');

                // Length must at least be 6
                if (lineParts.length < 6)
                    continue;

                // check if the first 6 parts are numbers
                var problem = false;
                for (var k = 0; k < 6; ++k) {
                    if (isNaN(parseFloat(lineParts[k]))) {
                        problem = true;
                        break;
                    }
                }
                if (problem)
                    continue;

                // assign the numbers to the checkpoint variable
                checkpoints[free_checkpoint] = {
                    'posx': parseFloat(lineParts[0]).toString(),
                    'posy': parseFloat(lineParts[1]).toString(),
                    'posz': parseFloat(lineParts[2]).toString(),
                    'rotx': parseFloat(lineParts[3]).toString(),
                    'roty': parseFloat(lineParts[4]).toString(),
                    'rotz': parseFloat(lineParts[5]).toString(),
                    'cobj': '[default]'
                }

                // Allways add commas
                /*for( var k in checkpoints[free_checkpoint] )
                {
                    if( k != 'cobj' && k != 'cmsg_handler' && checkpoints[free_checkpoint][k].search(/\./) < 0 )
                        checkpoints[free_checkpoint][k] += ".0";
                }*/

                ++free_checkpoint;
            }
        }

        // Initializations
        var canvas = document.getElementById("race_" + id + "_canvas");
        var context = canvas.getContext("2d");
        context.clearRect(0, 0, 220, 220);
        var maxX = 200.00;
        var maxZ = 200.00;
        var minX = 99999.00;
        var minZ = 99999.00;

        for (var k in checkpoints) {
            if (Math.ceil(parseFloat(checkpoints[k].posx)) > maxX) {
                maxX = checkpoints[k].posx;
            }
            if (Math.ceil(parseFloat(checkpoints[k].posx)) < minX) {
                minX = checkpoints[k].posx;
            }

            if (Math.ceil(parseFloat(checkpoints[k].posz)) > maxZ) {
                maxZ = checkpoints[k].posz;
            }
            if (Math.ceil(parseFloat(checkpoints[k].posz)) < minZ) {
                minZ = checkpoints[k].posz;
            }
        }

        // Transform the positions
        for (var k in checkpoints) {
            checkpoints[k].posz -= minZ;
            checkpoints[k].posx -= minX;
        }
        maxX -= minX;
        maxZ -= minZ;

        // We need at least 1 checkpoint
        if (checkpoints.length == 0)
            return;

        // Check if the race has laps
        var raceHasLaps = false;
        if ((document.getElementById("race_" + id + "_laps").value in myScriptFile.lapSelections)
            && (myScriptFile.lapSelections[document.getElementById("race_" + id + "_laps").value] != 'races.LAPS_NoLaps')
        ) {
            raceHasLaps = true;
        }

        // Put some dots whereever a checkpoint is
        context.fillStyle = "green";
        context.fillRect((checkpoints[0].posx / maxX * 180 + 10) - 5, (checkpoints[0].posz / maxZ * 180 + 10) - 5, 10, 10);
        context.fillStyle = "red";
        context.fillRect((checkpoints[checkpoints.length - 1].posx / maxX * 180 + 10) - 5, (checkpoints[checkpoints.length - 1].posz / maxZ * 180 + 10) - 5, 10, 10);
        for (var i = 0; i < checkpoints.length; ++i) {
            context.fillStyle = "blue";
            context.fillRect((checkpoints[i].posx / maxX * 180 + 10) - 2, (checkpoints[i].posz / maxZ * 180 + 10) - 2, 4, 4);
        }

        // connect the dots
        context.beginPath();
        context.moveTo((checkpoints[0].posx / maxX * 180 + 10), (checkpoints[0].posz / maxZ * 180 + 10));
        for (var i = 1; i < checkpoints.length; ++i) {
            context.lineTo((checkpoints[i].posx / maxX * 180 + 10), (checkpoints[i].posz / maxZ * 180 + 10));
        }
        if (raceHasLaps)
            context.lineTo((checkpoints[0].posx / maxX * 180 + 10), (checkpoints[0].posz / maxZ * 180 + 10));
        context.stroke();
        context.closePath();
    }


    // utils
    function fatalError(str) {
        return '<font color="red">FATAL| ' + str + '</font><br />';
    }

    function normalError(str) {
        return '<font color="orange">ERROR| ' + str + '</font><br />';
    }

    function noError(str) {
        return '<font color="green">SUCCESS| ' + str + '</font><br />';
    }

    function printMsg(str) {
        document.getElementById('errorMessageField').innerHTML += str + '<br />';
    }
</script> <form> <div id=formDiv> </div> <fieldset> <legend>General</legend> <fieldset> <legend>General Settings</legend> <!-- hacky hack--> <label for=race_-1_showCheckPointInfoWhenNotInRace>Show chp info?</label> <input type=checkbox id=race_-1_showCheckPointInfoWhenNotInRace name=raceName onchange="javascript: on_option_change('showCheckPointInfoWhenNotInRace', -1);"> <span class=info id=race_-1_showCheckPointInfoWhenNotInRace_info>[Current setting: If the user drives through a (not start line) checkpoint of a race that isn't running, nothing will happen.]</span> <br> <label for=general_terrnFilename>Script filename:</label> <input type=text class=inputBox id=general_terrnFilename name=general_terrnFilename> <span class=info>[optional, the extension of this file should be .as.]</span> <br> </fieldset> <fieldset> <legend>General abort points (advanced)</legend> <span class=intro>The race abort points defined here, will abort whichever race is running at that moment.</span> <span>General abort points:</span> <textarea id=race_-1_raceAbort class=checkpointsInputField style="height: 100px;"></textarea><br> <input type=text id=race_-1_raceAbort_posx value="pos x" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos x', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos x', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos x', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos x', ' 0.0 ');" style="margin-left: 1px;"> <input type=text id=race_-1_raceAbort_posy value="pos y" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos y', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos y', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos y', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos y', ' 0.0 ');"> <input type=text id=race_-1_raceAbort_posz value="pos z" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos z', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos z', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos z', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos z', ' 0.0 ');"> <input type=text id=race_-1_raceAbort_rotx value="rot x" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot x', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot x', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot x', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot x', ' 0.0 ');"> <input type=text id=race_-1_raceAbort_roty value="rot y" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot y', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot y', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot y', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot y', ' 0.0 ');"> <input type=text id=race_-1_raceAbort_rotz value="rot z" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot z', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot z', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot z', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot z', ' 0.0 ');"> <input type=text id=race_-1_raceAbort_cobj value=object class=shortTextField onfocus="javascript: on_checkpointField_focus(this, 'object', ' [default] ');" onblur="javascript: on_checkpointField_blur(this, 'object', ' [default] ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'object', ' [default] ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'object', ' [default] ');"> <br> <label>&nbsp;</label> <input type=text id=race_-1_raceAbort_cmsg value="message to show" class=longTextField onfocus="javascript: on_checkpointField_focus(this, 'message to show', ' [default] ');" onblur="javascript: on_checkpointField_blur(this, 'message to show', ' [default] ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'message to show', ' [default] ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'message to show', ' [default] ');"> <input type=button value=Add class=smallButton onclick="javascript: on_fieldAdd_click(-1, 'raceAbort', 'raceAbort');" style="width: 43px;"><br> <span class=info style="margin-left: 1px;">[Note: Leave the object or message field empty to use the default. You can change the defaults below.]</span> <br> <label for=race_-1_defaultAbort>Default abort object:</label> <input type=text class=inputBox id=race_-1_defaultAbort name=race_-1_defaultAbort value=trucktrigger onblur="javascript: enforceDefault(this, 'trucktrigger');"> <span class=info id=race_-1_defaultAbort_info>[optional, the object that should be used for race abort points if no object (or [default]) is specified above.]</span> <br> <label for=race_-1_abortMessage>Default abort message:</label> <input type=text class=inputBox id=race_-1_abortMessage name=general_abortMessage value=[noMessage] onblur="javascript: enforceDefault(this, '[noMessage]');"> <span class=info id=race_-1_abortMessage_info>[optional, the message that should be shown when a race is aborted and the [default] message is used above.]</span> <br> </fieldset> <fieldset> <legend>Add more races or generate the script</legend> <input type=button class=bigButton value="Add race" onclick="javascript: on_addRace_click();"> <span class=info>[Start here. You can have multiple races on 1 terrain.]</span> <br><br> <input type=button class=bigButton value="Generate script file!" onclick="javascript: on_generate_click();"> <span class=info>[Generate the scripting file when you're finished adding all the races.]</span> <br> </fieldset> <fieldset> <legend>Error log</legend> <div id=errorMessageField></div> </fieldset> </fieldset> <fieldset> <legend>Resulting script file</legend> <textarea id=scriptResult class=scriptResult></textarea> </fieldset> </form> <div style="display: none; width: 0px; height: 0px;" id=formTemplate> <fieldset id=race_{RACE_NUMBER} &lt;legend>Race {RACE_NUMBER}</legend> <div class=closeIcon onclick="javascript: on_closeIcon_click({RACE_NUMBER});">remove this race</div> <fieldset style="clear: right;"> <legend>General race info</legend> <label for=race_{RACE_NUMBER}_raceName>Race name:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_raceName name=race_{RACE_NUMBER}_raceName> <br><br> <label for=race_{RACE_NUMBER}_laps>Amount of laps:</label> <select id=race_{RACE_NUMBER}_laps onchange="javascript: on_laps_change(this, {RACE_NUMBER});"> <option value="No laps (the first checkpoint will be the start line and the last checkpoint will be the finish line)" selected=selected>No laps (the first checkpoint will be the start line and the last checkpoint will be the finish line) </option> <option value="1 lap (the first checkpoint will be both the start and finish line)">1 lap (the first checkpoint will be both the start and finish line) </option> <option value="2 laps">2 laps</option> <option value="3 laps">3 laps</option> <option value="4 laps">4 laps</option> <option value="5 laps">5 laps</option> <option value="6 laps">6 laps</option> <option value="7 laps">7 laps</option> <option value="8 laps">8 laps</option> <option value="9 laps">9 laps</option> <option value="Never ending race (unlimited amount of laps)">Never ending race (unlimited amount of laps) </option> <option value=other...>other...</option> </select><br> <label for=race_{RACE_NUMBER}_lapsOther>&nbsp;</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_lapsOther name=race_{RACE_NUMBER}_lapsOther style="display: none;" value="10 laps"> <br> <label for=race_{RACE_NUMBER}_version>Race version:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_version name=race_{RACE_NUMBER}_version> <span class=info id=race_{RACE_NUMBER}_version_info>[optional]</span> <br> </fieldset> <fieldset> <legend>Race options (advanced)</legend> <label for=race_{RACE_NUMBER}_obligatedFinish>Finishing obligatory?</label> <input type=checkbox id=race_{RACE_NUMBER}_obligatedFinish name=raceName onchange="javascript: on_option_change('obligatedFinish', {RACE_NUMBER});"> <span class=info id=race_{RACE_NUMBER}_obligatedFinish_info>[Current setting: If you drive through the start checkpoint of a race while already in another race, the current race will be aborted and the other race will start.]</span> <br> <label for=race_{RACE_NUMBER}_showTimeDiff>Show time difference?</label> <input type=checkbox id=race_{RACE_NUMBER}_showTimeDiff name=raceName checked=checked onchange="javascript: on_option_change('showTimeDiff', {RACE_NUMBER});"> <span class=info id=race_{RACE_NUMBER}_showTimeDiff_info>[Current setting: Show + or - [best time minus current time] when passing a checkpoint.]</span> <br> <label for=race_{RACE_NUMBER}_showBestLap>Show best lap time?</label> <input type=checkbox id=race_{RACE_NUMBER}_showBestLap name=raceName checked=checked onchange="javascript: on_option_change('showBestLap', {RACE_NUMBER});"> <span class=info id=race_{RACE_NUMBER}_showBestLap_info>[Current setting: If a race is started or a new best lap is set, the best lap will be shown.]</span> <br> <label for=race_{RACE_NUMBER}_showBestRace>Show best race time?</label> <input type=checkbox id=race_{RACE_NUMBER}_showBestRace name=raceName checked=checked onchange="javascript: on_option_change('showBestRace', {RACE_NUMBER});"> <span class=info id=race_{RACE_NUMBER}_showBestRace_info>[Current setting: If a race is started or a new best race time is set, the best race time will be shown.]</span> <br> <label for=race_{RACE_NUMBER}_submitScore>Submit best time?</label> <input type=checkbox id=race_{RACE_NUMBER}_submitScore name=raceName checked=checked onchange="javascript: on_option_change('submitScore', {RACE_NUMBER});"> <span class=info id=race_{RACE_NUMBER}_submitScore_info>[Current setting: If the user has a new best lap time or new best race time, then this time is submitted to the master server.]</span> <br> <label for=race_{RACE_NUMBER}_silentMode>Silent mode?</label> <input type=checkbox id=race_{RACE_NUMBER}_silentMode name=raceName onchange="javascript: on_option_change('silentMode', {RACE_NUMBER});"> <span class=info id=race_{RACE_NUMBER}_silentMode_info>[Current setting: The user will be informed about running races.]</span> <br> <label for=race_{RACE_NUMBER}_restartRaceOnStart>Allow race restart?</label> <input type=checkbox id=race_{RACE_NUMBER}_restartRaceOnStart name=raceName checked=checked onchange="javascript: on_option_change('restartRaceOnStart', {RACE_NUMBER});"> <span class=info id=race_{RACE_NUMBER}_restartRaceOnStart_info>[Current setting: The race will be restarted when you pass the start line of the same race.]</span> <br> </fieldset> <fieldset> <legend>Checkpoint locations and checkpoint objects</legend> <label for=race_{RACE_NUMBER}_checkpoints>Checkpoint coordinates:</label> <textarea id=race_{RACE_NUMBER}_checkpoints class=checkpointsInputField onchange="javascript: drawPreview({RACE_NUMBER});"></textarea> <input type=text id=race_{RACE_NUMBER}_chpAdd_posx value="pos x" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos x', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos x', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos x', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos x', ' 0.0 ');" style="margin-left: 1px;"> <input type=text id=race_{RACE_NUMBER}_chpAdd_posy value="pos y" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos y', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos y', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos y', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos y', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_chpAdd_posz value="pos z" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos z', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos z', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos z', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos z', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_chpAdd_rotx value="rot x" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot x', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot x', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot x', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot x', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_chpAdd_roty value="rot y" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot y', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot y', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot y', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot y', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_chpAdd_rotz value="rot z" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot z', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot z', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot z', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot z', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_chpAdd_cobj value=object class=shortTextField onfocus="javascript: on_checkpointField_focus(this, 'object', ' [default] ');" onblur="javascript: on_checkpointField_blur(this, 'object', ' [default] ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'object', ' [default] ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'object', ' [default] ');"> <input type=button value=Add class=smallButton onclick="javascript: on_fieldAdd_click({RACE_NUMBER}, 'chpAdd', 'checkpoints');"><br> <span class=info style="margin-left: 1px;">[Note: Leave the object field empty to use the default. You can change the defaults below.]</span> <br> <label for=race_{RACE_NUMBER}_defaultStart>Default start object:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_defaultStart name=race_{RACE_NUMBER}_defaultStart value=chp-start onblur="javascript: enforceDefault(this, 'chp-start');"> <span class=info id=race_{RACE_NUMBER}_defaultStart_info>[optional, the start line object that should be used if it wasn't specified with in the checkpointlist above.]</span> <br> <label for=race_{RACE_NUMBER}_defaultCheckpoint>Default chp object:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_defaultCheckpoint name=race_{RACE_NUMBER}_defaultCheckpoint value=chp-checkpoint onblur="javascript: enforceDefault(this, 'chp-checkpoint');"> <span class=info id=race_{RACE_NUMBER}_defaultCheckpoint_info>[optional, the checkpoint object that should be used for all checkpoints that do not have an object specified in the checkpointlist above.]</span> <br> <label for=race_{RACE_NUMBER}_defaultFinish>Default finish object:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_defaultFinish name=race_{RACE_NUMBER}_defaultFinish value=chp-start onblur="javascript: enforceDefault(this, 'chp-start');"> <span class=info id=race_{RACE_NUMBER}_defaultFinish_info>[optional, the finish line object that should be used if it wasn't specified with in the checkpointlist above.]</span> <br> <label for=race_{RACE_NUMBER}_canvas>Preview:</label> <canvas id=race_{RACE_NUMBER}_canvas style="vertical-align: top;" width=220 height=220>Unsupported browser! </canvas> <br> <br> </fieldset> <fieldset> <legend>Race abort points (advanced)</legend> <label for=race_{RACE_NUMBER}_raceAbort>Race abort points:</label> <textarea id=race_{RACE_NUMBER}_raceAbort class=checkpointsInputField style="height: 100px;"></textarea><br> <input type=text id=race_{RACE_NUMBER}_raceAbort_posx value="pos x" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos x', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos x', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos x', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos x', ' 0.0 ');" style="margin-left: 1px;"> <input type=text id=race_{RACE_NUMBER}_raceAbort_posy value="pos y" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos y', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos y', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos y', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos y', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_raceAbort_posz value="pos z" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'pos z', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'pos z', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'pos z', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'pos z', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_raceAbort_rotx value="rot x" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot x', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot x', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot x', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot x', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_raceAbort_roty value="rot y" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot y', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot y', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot y', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot y', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_raceAbort_rotz value="rot z" class=smallNumberField onfocus="javascript: on_checkpointField_focus(this, 'rot z', ' 0.0 ');" onblur="javascript: on_checkpointField_blur(this, 'rot z', ' 0.0 ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'rot z', ' 0.0 ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'rot z', ' 0.0 ');"> <input type=text id=race_{RACE_NUMBER}_raceAbort_cobj value=object class=shortTextField onfocus="javascript: on_checkpointField_focus(this, 'object', ' [default] ');" onblur="javascript: on_checkpointField_blur(this, 'object', ' [default] ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'object', ' [default] ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'object', ' [default] ');"> <br> <label>&nbsp;</label> <input type=text id=race_{RACE_NUMBER}_raceAbort_cmsg value="message to show" class=longTextField onfocus="javascript: on_checkpointField_focus(this, 'message to show', ' [default] ');" onblur="javascript: on_checkpointField_blur(this, 'message to show', ' [default] ');" onmouseover="javascript: on_checkpointField_mouseOver(this, 'message to show', ' [default] ');" onmouseout="javascript: on_checkpointField_mouseOut(this, 'message to show', ' [default] ');"> <input type=button value=Add class=smallButton onclick="javascript: on_fieldAdd_click({RACE_NUMBER}, 'raceAbort', 'raceAbort');" style="width: 43px;"><br> <span class=info style="margin-left: 1px;">[Note: Leave the object or message field empty to use the default. You can change the defaults below.]</span> <br> <label for=race_{RACE_NUMBER}_defaultAbort>Default abort object:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_defaultAbort name=race_{RACE_NUMBER}_defaultAbort value=trucktrigger onblur="javascript: enforceDefault(this, 'trucktrigger');"> <span class=info id=race_{RACE_NUMBER}_defaultAbort_info>[optional, the object that should be used for race abort points if no object (or [default] object) is specified above.]</span> <br> <label for=race_{RACE_NUMBER}_abortMessage>Default abort message:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_abortMessage name=general_abortMessage value=[noMessage] onblur="javascript: enforceDefault(this, '[noMessage]');"> <span class=info id=race_{RACE_NUMBER}_abortMessage_info>[optional, the message that should be shown when a race is aborted and the [default] message is used above.]</span> <br> </fieldset> <fieldset> <legend>Race penalty events (advanced)</legend> The settings in this box only apply if a 'race_penalty' box was triggered.<br> You can define 'race_penalty' points in the odef file of your checkpoint.<br> <label for=race_{RACE_NUMBER}_penaltySeconds>Penalty seconds:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_penaltySeconds name=race_{RACE_NUMBER}_penaltySeconds value=10 onblur="javascript: enforceDefault(this, '10');"> <span class=info id=race_{RACE_NUMBER}_penaltySeconds_info>[the amount of seconds that should be added to the lap time when the penalty event is triggered.]</span> <br> <label for=race_{RACE_NUMBER}_penaltyMessage>Message:</label> <input type=text class=inputBox id=race_{RACE_NUMBER}_penaltyMessage name=race_{RACE_NUMBER}_penaltyMessage value=[noMessage] onblur="javascript: enforceDefault(this, '[noMessage]');"> <span class=info id=race_{RACE_NUMBER}_penaltyMessage_info>[optional, the message that should be shown when a penalty event is triggered.]</span> <br> </fieldset> </fieldset> <br> </div> <p><br></p> <p><br><br></p> <h2 id=what-is-this>What is this?<a class=headerlink href=#what-is-this title="Permanent link">&para;</a></h2> <p>This is a generator for creating functional races (or timers) for terrains in Rigs of Rods, created by Neorej16 and ported to docs.rigsofrods.org by CuriousMike.</p> <h2 id=instructions>Instructions<a class=headerlink href=#instructions title="Permanent link">&para;</a></h2> <p>Start by clicking "Add race". You can have multiple races on one terrain. </p> <h3 id=general-race-info>General race info<a class=headerlink href=#general-race-info title="Permanent link">&para;</a></h3> <h4 id=race-name>Race name<a class=headerlink href=#race-name title="Permanent link">&para;</a></h4> <p>The name of your race, shown in the top left corner. </p> <h4 id=amount-of-laps>Amount of laps<a class=headerlink href=#amount-of-laps title="Permanent link">&para;</a></h4> <p>The amount of laps your race will have. For point-to-point races, set "No laps".</p> <h4 id=race-version>Race version<a class=headerlink href=#race-version title="Permanent link">&para;</a></h4> <p>The version number of your race. (e.g. <code>authorName-1.0</code>).</p> <h3 id=race-options>Race options<a class=headerlink href=#race-options title="Permanent link">&para;</a></h3> <h4 id=finishing-obligatory>Finishing obligatory?<a class=headerlink href=#finishing-obligatory title="Permanent link">&para;</a></h4> <p>Disabled (Default): If you drive through the start checkpoint of a race while already in another race, the current race will be aborted and the other race will start.</p> <p>Enabled: If you drive through the start checkpoint of a race while already in another race, the current race will continue and the other race start line will be ignored.</p> <h4 id=show-time-difference>Show time difference?<a class=headerlink href=#show-time-difference title="Permanent link">&para;</a></h4> <p>Enabled (Default): Show + or - [best time minus current time] when passing a checkpoint.</p> <p>Disabled: Only show the current time when you pass a checkpoint.</p> <h4 id=show-best-lap-time>Show best lap time?<a class=headerlink href=#show-best-lap-time title="Permanent link">&para;</a></h4> <p>Enabled (Default): If a race is started or a new best lap is set, the best lap will be shown.</p> <p>Disabled: Best lap times won't be shown to the user.</p> <h4 id=show-best-race-time>Show best race time?<a class=headerlink href=#show-best-race-time title="Permanent link">&para;</a></h4> <p>Enabled (Default): If a race is started or a new best race time is set, the best race time will be shown.</p> <p>Disabled: Best lap times won't be shown to the user.</p> <h4 id=submit-best-time>Submit best time?<a class=headerlink href=#submit-best-time title="Permanent link">&para;</a></h4> <p>Enabled (Default): If the user has a new best lap time or new best race time, then this time is submitted to the master server.</p> <p>Disabled: Race and lap times won't be sent to the master server.</p> <h4 id=silent-mode>Silent mode?<a class=headerlink href=#silent-mode title="Permanent link">&para;</a></h4> <p>Disabled (Default): The user will be informed about running races.</p> <p>Enabled: No info will be shown to the user, except for the timer.</p> <h4 id=allow-race-restart>Allow race restart?<a class=headerlink href=#allow-race-restart title="Permanent link">&para;</a></h4> <p>Enabled (Default): The race will be restarted when you pass the start line of the same race.</p> <p>Disabled: The race will continue to run without resetting the time when you pass the start line of the same race.</p> <h3 id=checkpoint-locations-and-objects>Checkpoint locations and objects<a class=headerlink href=#checkpoint-locations-and-objects title="Permanent link">&para;</a></h3> <p>This section defines the locations of the checkpoints and what objects to use for the checkpoints.</p> <h4 id=retrieving-checkpoint-coordinates>Retrieving checkpoint coordinates<a class=headerlink href=#retrieving-checkpoint-coordinates title="Permanent link">&para;</a></h4> <p>To easily get the checkpoint coordinates, do the following:</p> <ul> <li> <p>Open RoR and select your terrain </p> </li> <li> <p>While not in a vehicle, walk to where you want your checkpoint to be, then press the <code>H</code> key. Repeat for all checkpoints you want to add. </p> </li> <li> <p>When finished, exit RoR and open the <code>RoR.log</code> file, located at <code>Documents\My Games\Rigs of Rods\logs</code>.</p> </li> <li> <p>Scroll to the end of the file, you should see position lines like the following:</p> </li> </ul> <div class=highlight><pre><span></span><code>00:58:49: Position:  486.504,    0.000,  512.000,    0.0,  360.0,    0.0
00:58:58: Position:  457.481,    0.000,  500.993,    0.0,  396.3,    0.0
00:59:05: Position:  470.764,    0.000,  464.283,    0.0,  484.1,    0.0
00:59:14: Position:  526.697,    0.000,  482.188,    0.0,  573.8,    0.0
00:59:20: Position:  564.749,    0.000,  465.543,    0.0,  512.7,    0.0
00:59:26: Position:  584.245,    0.000,  496.841,    0.0,  613.8,    0.0
00:59:32: Position:  550.343,    0.000,  511.211,    0.0,  716.8,    0.0
</code></pre></div> <p>These are your checkpoint's position coordinates. Copy the lines to a new file as you'll need to edit it later.</p> <h4 id=adding-coordinates>Adding coordinates<a class=headerlink href=#adding-coordinates title="Permanent link">&para;</a></h4> <p>To add the coordinates you retrieved from the log file, edit the lines to match the format below:</p> <div class=highlight><pre><span></span><code>486.504,    0.000,  512.000,    0.0,  360.0,    0.0, [default]
457.481,    0.000,  500.993,    0.0,  396.3,    0.0, [default]
470.764,    0.000,  464.283,    0.0,  484.1,    0.0, [default]
526.697,    0.000,  482.188,    0.0,  573.8,    0.0, [default]
564.749,    0.000,  465.543,    0.0,  512.7,    0.0, [default]
584.245,    0.000,  496.841,    0.0,  613.8,    0.0, [default]
550.343,    0.000,  511.211,    0.0,  716.8,    0.0, [default]
</code></pre></div> <p>Then paste the lines into the "Checkpoint coordinates" box. Example:</p> <p><img alt=race-chp-example src=../../images/race-chp-example.png></p> <p>A preview of the checkpoint layout will be shown.</p> <h4 id=checkpoint-objects>Checkpoint objects<a class=headerlink href=#checkpoint-objects title="Permanent link">&para;</a></h4> <p>At the end of each coordinate line is the name of the checkpoint object. This defines the checkpoint visuals.</p> <p>Each line can have a different checkpoint object. However, for simplicity's sake, you can set the default object names in the <code>Default start / checkpoint / finish object</code> sections. These objects will be used if you specify a checkpoint name in the coordinates list as <code>[default]</code>.</p> <p>By default, RoR includes these checkpoint models:</p> <p><img alt=race-chp src=../../images/race-chp.png></p> <p>The names for these objects are <code>chp-start</code> and <code>chp-checkpoint</code>.</p> <p>You can also use a custom object. Here are a few checkpoints you can use, just extract the contents into your terrain's zip file:</p> <h5 id=f1-test-track-checkpoint>F1 Test Track Checkpoint<a class=headerlink href=#f1-test-track-checkpoint title="Permanent link">&para;</a></h5> <p><img alt=race-chp-f1 src=../../images/race-chp-f1.png></p> <p>These are the checkpoints from <a href=https://forum.rigsofrods.org/resources/f1-test-track.244/ >F1 Test Track</a>, updated with fixed normals and new textures.</p> <p>Object names: <code>new-checkpoint-start</code> and <code>new-checkpoint</code>.</p> <p>Download: <a href=../../download/f1_checkpoint.zip>f1_checkpoint.zip</a></p> <h5 id=empty-checkpoint>Empty Checkpoint<a class=headerlink href=#empty-checkpoint title="Permanent link">&para;</a></h5> <p>This checkpoint has no visuals. Useful for meshed terrains which have a clearly defined layout (such as tracks) or multiple races which share checkpoint locations. </p> <p>Object name: <code>empty-checkpoint</code>.</p> <p>Download: <a href=../../download/empty_checkpoint.zip>empty_checkpoint.zip</a></p> <h3 id=race-abort-points>Race abort points<a class=headerlink href=#race-abort-points title="Permanent link">&para;</a></h3> <p>Optional, defines points which will abort the current race. Use the same coordinate format as above. </p> <h3 id=race-penalty-events>Race penalty events<a class=headerlink href=#race-penalty-events title="Permanent link">&para;</a></h3> <p>Not used by any of the included checkpoints. Defines settings for the <code>race_penalty</code> box. </p> <p>To add a <code>race_penalty</code> box, edit the <a href=../object-format/ >odef</a> file of your checkpoint. (See begin box section)</p> <h3 id=general-settings>General settings<a class=headerlink href=#general-settings title="Permanent link">&para;</a></h3> <h4 id=show-checkpoint-info>Show checkpoint info?<a class=headerlink href=#show-checkpoint-info title="Permanent link">&para;</a></h4> <p>Disabled (Default): If the user drives through a (not start line) checkpoint of a race that isn't running, nothing will happen.</p> <p>Enabled: If the user drives through a checkpoint of a race that isn't running, a message will be shown, saying "this is checkpoint X of race myRaceName".</p> <h4 id=script-filename>Script filename<a class=headerlink href=#script-filename title="Permanent link">&para;</a></h4> <p>The file name of your race script with the <code>.as</code> file extension. Example: <code>myTerrain.as</code></p> <h3 id=general-abort-points>General abort points<a class=headerlink href=#general-abort-points title="Permanent link">&para;</a></h3> <p>Optional, defines points which will abort any current race. Use the same coordinate format as above. </p> <h2 id=generating-completed-script>Generating completed script<a class=headerlink href=#generating-completed-script title="Permanent link">&para;</a></h2> <p>Once you're finally done setting up your race(s), click <code>Generate script file!</code> to generate the finished script. </p> <p>Example completed script of a basic 2 lap race on Simple Test Terrain:</p> <div class=highlight><pre><span></span><code>// Filename: TestRace.as
// This file was generated using the docs.rigsofrods.org race script generator.
#include &quot;base.as&quot;;
#include &quot;races.as&quot;;

racesManager races();


// GENERAL SECTION 0 START
int race_0_Simple_Test_Race_ID;
// GENERAL SECTION 0 END


// GENERAL SECTION GENERAL START

// GENERAL SECTION GENERAL END


void main()
{
    races.setCallback(&#39;RaceStart&#39;, on_RaceStart_event);
    races.setCallback(&#39;PenaltyEvent&#39;, on_PenaltyEvent_event);
    races.showCheckPointInfoWhenNotInRace = true;

    // MAIN SECTION 0 START
    race_0_Simple_Test_Race_ID = races.addNewEmptyRace();
    races.setRaceName(race_0_Simple_Test_Race_ID, &quot;Simple Test Race&quot;);
    races.setLaps(race_0_Simple_Test_Race_ID, 2);
    array&lt;array&lt;double&gt;&gt; race_0_coords = {
        {486.504, 0.0, 512.0, 0.0, 360.0, 0.0},
        {457.481, 0.0, 500.993, 0.0, 396.3, 0.0},
        {470.764, 0.0, 464.283, 0.0, 484.1, 0.0},
        {526.697, 0.0, 482.188, 0.0, 573.8, 0.0},
        {564.749, 0.0, 465.543, 0.0, 512.7, 0.0},
        {584.245, 0.0, 496.841, 0.0, 613.8, 0.0},
        {550.343, 0.0, 511.211, 0.0, 716.8, 0.0}
    };
    races.addCheckpoint(race_0_Simple_Test_Race_ID, 0, &quot;chp-start&quot;, race_0_coords[0]);
    races.addCheckpoint(race_0_Simple_Test_Race_ID, 1, &quot;chp-checkpoint&quot;, race_0_coords[1]);
    races.addCheckpoint(race_0_Simple_Test_Race_ID, 2, &quot;chp-checkpoint&quot;, race_0_coords[2]);
    races.addCheckpoint(race_0_Simple_Test_Race_ID, 3, &quot;chp-checkpoint&quot;, race_0_coords[3]);
    races.addCheckpoint(race_0_Simple_Test_Race_ID, 4, &quot;chp-checkpoint&quot;, race_0_coords[4]);
    races.addCheckpoint(race_0_Simple_Test_Race_ID, 5, &quot;chp-checkpoint&quot;, race_0_coords[5]);
    races.addCheckpoint(race_0_Simple_Test_Race_ID, 6, &quot;chp-checkpoint&quot;, race_0_coords[6]);
    races.setVersion(race_0_Simple_Test_Race_ID, &quot;CuriousMike-1.0&quot;);
    races.setPenaltyTime(race_0_Simple_Test_Race_ID, 10);
    races.finalize(race_0_Simple_Test_Race_ID);
    // MAIN SECTION 0 END


}

void on_RaceStart_event(dictionary@ event)
{
    int raceID;
    event.get(&#39;raceID&#39;, raceID);


    // RACESTART SECTION 0 START
    if( raceID == race_0_Simple_Test_Race_ID )
    {
        races.obligatedFinish = false;
        races.showTimeDiff = true;
        races.showBestLap = true;
        races.showBestRace = true;
        races.submitScore = true;
        races.silentMode = false;
        races.restartRaceOnStart = true;
    }
    // RACESTART SECTION 0 END


}

void on_PenaltyEvent_event(dictionary@ event)
{
    int raceID;
    event.get(&#39;raceID&#39;, raceID);


    // PENALTYEVENT SECTION 0 START
    // PENALTYEVENT SECTION 0 END


}

void eventCallback(int eventnum, int value)
{
    races.eventCallback(eventnum, value);
}
</code></pre></div> <h2 id=adding-script-to-terrain>Adding script to terrain<a class=headerlink href=#adding-script-to-terrain title="Permanent link">&para;</a></h2> <p>To add your generated script to the terrain, copy the script (CTRL+A to select all) into a text editor such as Notepad or Notepad++.</p> <p>Save the file with the <code>.as</code> file extension: <strong>Make sure to set the file type to "All files"!</strong></p> <p><img alt=race-script-save src=../../images/race-script-save.png></p> <p>Place the file into your terrain's zip, then open the terrain's <code>.terrn2</code> file. </p> <p>At the end of the <code>terrn2</code>, add (or edit) the <code>[Scripts]</code> section:</p> <div class=highlight><pre><span></span><code>[Scripts]
TestRace.as=
</code></pre></div> <p>Save your changes and place the edited <code>terrn2</code> back into the terrain zip if necessary.</p> <h3 id=in-game>In-game<a class=headerlink href=#in-game title="Permanent link">&para;</a></h3> <p>If everything went well, you should now have your race in RoR!</p> <p><img alt=race-ingame src=../../images/race-ingame.png></p> <h2 id=fine-tuning-checkpoint-locations>Fine tuning checkpoint locations<a class=headerlink href=#fine-tuning-checkpoint-locations title="Permanent link">&para;</a></h2> <p>When testing your race, your checkpoints may not be in the correct location or rotated correctly. </p> <p>To adjust your checkpoint positions, use the <a href=../editing-terrain-objects/#moving-objects>in-game object editor</a>.</p> <p>Checkpoints are spawned first, so use <code>CTRL+[</code> and <code>CTRL+]</code> keys to scroll through each one.</p> <p><img alt=race-chp-adjust src=../../images/race-chp-adjust.png></p> <p>Once you're done moving your checkpoints. exit editor mode (<code>CTRL+Y</code>) then exit the game. </p> <p>In <code>editor_out.cfg</code>, the checkpoint locations will be at the top of the file:</p> <div class=highlight><pre><span></span><code> 486.504,    0.000,  512.000,    0.0,   90.0,    0.0, chp-start
 457.481,    0.000,  500.993,    0.0,  396.3,    0.0, chp-checkpoint
 470.764,    0.000,  464.283,    0.0,  484.1,    0.0, chp-checkpoint
 526.697,    0.000,  482.188,    0.0,  573.8,    0.0, chp-checkpoint
 577.081,    0.000,  478.170,    0.0,  480.0,    0.0, chp-checkpoint
 596.938,    0.000,  494.067,    0.0,  718.4,    0.0, chp-checkpoint
 550.343,    0.000,  511.211,    0.0,   90.0,    0.0, chp-checkpoint
</code></pre></div> <p>Edit the lines to match the following format:</p> <div class=highlight><pre><span></span><code>{486.504,    0.000,  512.000,    0.0,   90.0,    0.0},
{457.481,    0.000,  500.993,    0.0,  396.3,    0.0},
{470.764,    0.000,  464.283,    0.0,  484.1,    0.0},
{526.697,    0.000,  482.188,    0.0,  573.8,    0.0},
{577.081,    0.000,  478.170,    0.0,  480.0,    0.0},
{596.938,    0.000,  494.067,    0.0,  718.4,    0.0},
{550.343,    0.000,  511.211,    0.0,   90.0,    0.0}
</code></pre></div> <p>Paste the lines into your race script file, replacing the existing positions:</p> <div class=highlight><pre><span></span><code>    array&lt;array&lt;double&gt;&gt; race_0_coords = {
        {486.504,    0.000,  512.000,    0.0,   90.0,    0.0},
        {457.481,    0.000,  500.993,    0.0,  396.3,    0.0},
        {470.764,    0.000,  464.283,    0.0,  484.1,    0.0},
        {526.697,    0.000,  482.188,    0.0,  573.8,    0.0},
        {577.081,    0.000,  478.170,    0.0,  480.0,    0.0},
        {596.938,    0.000,  494.067,    0.0,  718.4,    0.0},
        {550.343,    0.000,  511.211,    0.0,   90.0,    0.0}
    };
</code></pre></div> <p>Save the script and try it in-game. Your checkpoints should now be in the correct place.</p> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <p>If your race doesn't appear in-game, check your terrain's <code>.terrn2</code> file to make sure the <code>[Scripts]</code> section is correct and that your script is in the terrain zip.</p> <p>Otherwise, your script may have a syntax error. Browse to <code>Documents\My Games\Rigs of Rods\logs</code> and open <code>Angelscript.log</code> with Notepad. Script errors will be shown there. </p> <p>Look at the completed example script above for reference.</p> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>Congratulations, you now know the basics of adding races to Rigs of Rods using the race script generator!</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 4, 2026 02:04:31 UTC">January 4, 2026</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../building-rail-tracks/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Building rail tracks"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Building rail tracks </div> </div> </a> <a href=../scripting/ class="md-footer__link md-footer__link--next" aria-label="Next: Scripting"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Scripting </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=https://docs.rigsofrods.org/ target=_blank>End-user documentation for the Rigs of Rods project. &copy; 2013-2025 Rigs of Rods documentation contributors.</a> </div> </div> <div class=md-social> <a href=https://x.com/rigsofrods target=_blank rel=noopener title="Rigs of Rods on X" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg> </a> <a href=https://discord.gg/rigsofrods target=_blank rel=noopener title="Rigs of Rods on Discord" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=https://youtube.com/@rigsofrods_official target=_blank rel=noopener title="Rigs of Rods on YouTube" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"/></svg> </a> <a href=https://fosstodon.org/@rigsofrods target=_blank rel="noopener me" title="Rigs of Rods on Mastodon" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg> </a> <a href=https://facebook.com/RigsOfRods target=_blank rel=noopener title="Rigs of Rods on Facebook" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.footer", "navigation.top", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>